<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Where the fuck is my girlfriend?</title>

  <!-- Fonts: Pinyon Script (title), Inika (everything else) -->
  <link href="https://fonts.googleapis.com/css2?family=Inika:wght@400;700&family=Pinyon+Script&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg1:#eddcff;
      --bg2:#dcc6ff;
      --card-bg: rgba(255,255,255,0.16);
      --ink:#1b1330;
      --ring: rgba(255,255,255,0.45);
      --accent:#b388ff;
      --shadow: 0 12px 30px rgba(20,10,40,.18);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      /* darker purple hearts */
      background:
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28'><path d='M14 22s-7-4.7-9.5-8.1c-2.1-2.9-1.1-6.9 2.2-8 1.9-.6 4 .2 5.1 1.7 1.2-1.5 3.3-2.3 5.1-1.7 3.3 1.1 4.3 5.1 2.2 8C21 17.3 14 22 14 22z' fill='%23130a2633'/></svg>") repeat,
        linear-gradient(160deg,var(--bg1),var(--bg2));
      background-size: 28px 28px, auto;
      color:var(--ink);
      font-family: 'Inika', serif;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .wrap{ width:min(840px,95vw); text-align:center; }

    .card{
      background:var(--card-bg);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border:2px solid var(--ring);
      border-radius:22px;
      padding:22px clamp(14px,4vw,28px);
      box-shadow: var(--shadow);
      color:var(--ink);
      text-align:center;
      position:relative;
    }
    .header-card { margin-bottom: 16px; }

    .title{
      margin:0;
      font-family:'Pinyon Script', cursive; /* title only */
      font-size: clamp(28px, 6vw, 54px);
      font-weight: 400;
      color:#000;
      line-height:1.05;
    }
    #dayLabel{
      margin:8px 0 0 0;
      font-size: clamp(16px, 3.6vw, 28px);  /* smaller per your request */
      font-weight: 700;
      letter-spacing:.2px;
      color:#000;
      font-family: 'Inika', serif;
    }

    .big{
      font-size: clamp(22px, 4.6vw, 34px);
      font-weight: 700;
      line-height: 1.25;
    }
    .range, .clock{
      font-size: clamp(14px, 2.6vw, 18px);
      opacity: 0.95;
      margin-top: 10px;
      font-weight: 400;
    }

    /* TZ toggle */
    .tz-toggle{
      position:absolute; top:10px; right:10px;
      background: var(--accent);
      color:#fff; border:none; cursor:pointer;
      font-weight:700; border-radius:999px;
      padding:6px 12px; box-shadow:0 8px 18px rgba(0,0,0,.15);
      letter-spacing:.2px;
      font-family: 'Inika', serif;
    }
    .tz-menu{
      position:absolute; top:48px; right:10px;
      background:#fff; color:#1f1236;
      border-radius:12px; border:2px solid var(--ring);
      box-shadow: var(--shadow);
      display:none; min-width: 190px; overflow:hidden;
      text-align:left;
      font-family: 'Inika', serif;
      z-index: 10;
    }
    .tz-item{ padding:10px 12px; cursor:pointer; font-weight:700; border-bottom:1px solid #00000010; }
    .tz-item:last-child{ border-bottom:none; }
    .tz-item:hover{ background:#f3ecff; }

    /* Preview controls (optional) */
    .preview-toggle{
      position:absolute; top:10px; left:10px;
      background:#fff; color:#1f1236; border:none; cursor:pointer;
      font-weight:700; border-radius:999px;
      padding:6px 12px; box-shadow:0 8px 18px rgba(0,0,0,.12);
      letter-spacing:.2px;
      font-family: 'Inika', serif;
      border:2px solid var(--ring);
    }
    .preview-panel{
      position:absolute; top:48px; left:10px;
      background:#fff; color:#1f1236;
      border-radius:12px; border:2px solid var(--ring);
      box-shadow: var(--shadow);
      display:none; min-width: 220px; padding:10px;
      text-align:left; z-index: 10; font-family:'Inika',serif;
    }
    .row{ display:flex; gap:8px; align-items:center; margin:6px 0; }
    select,input[type="time"]{
      border:1px solid #ddd; border-radius:8px; padding:6px 8px; font-family:'Inika',serif;
    }
    .btn{
      background:var(--accent); color:#fff; border:none; border-radius:10px; padding:6px 10px;
      font-weight:700; cursor:pointer; font-family:'Inika',serif;
    }
    .btn.secondary{ background:#eee; color:#1f1236; border:1px solid #ddd; }

    @media (prefers-reduced-motion:no-preference){
      .fade{ animation:fade .4s ease-out }
      @keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header card: Title + Day -->
    <div class="card header-card fade">
      <h1 class="title">Where the fuck is my girlfriend?</h1>
      <h2 id="dayLabel">Loadingâ€¦</h2>
    </div>

    <!-- Main class/status card -->
    <div class="card fade">
      <!-- Optional time-travel preview -->
      <button id="previewToggle" class="preview-toggle" aria-haspopup="true" aria-expanded="false">Preview</button>
      <div id="previewPanel" class="preview-panel" role="dialog" aria-label="Preview time">
        <div class="row">
          <label for="prevDay" style="min-width:70px">Day</label>
          <select id="prevDay">
            <option value="0">Sunday</option>
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3">Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
          </select>
        </div>
        <div class="row">
          <label for="prevTime" style="min-width:70px">Time</label>
          <input id="prevTime" type="time" step="60" value="10:00">
        </div>
        <div class="row" style="justify-content:flex-end; gap:8px; margin-top:8px">
          <button id="applyPreview" class="btn">Apply</button>
          <button id="clearPreview" class="btn secondary">Live</button>
        </div>
      </div>

      <!-- TZ toggle -->
      <button id="tzToggle" class="tz-toggle" aria-haspopup="true" aria-expanded="false">ðŸŒ´ California</button>
      <div id="tzMenu" class="tz-menu" role="menu" aria-label="Display timezone">
        <div class="tz-item" data-tz="CA" role="menuitem">ðŸŒ´ California</div>
        <div class="tz-item" data-tz="CHI" role="menuitem">ðŸ«˜ Chicago</div>
      </div>

      <div id="status" class="big">Loadingâ€¦</div>
      <div id="range" class="range">â€”</div>
      <div id="clock" class="clock">â€”</div>
    </div>
  </div>

  <script>
    /* ===== Schedule (anchored to California) ===== */
    const schedule = {
      1: [
        { name: "Chemistry",           start: "10:00", end: "10:50" },
        { name: "Intro to Psychology", start: "11:00", end: "12:15" },
        { name: "Uncanny",             start: "13:15", end: "14:30" },
      ],
      2: [ { name: "Reasoning bout Unreasonable", start: "11:00", end: "12:15" } ],
      3: [
        { name: "Chemistry",           start: "10:00", end: "10:50" },
        { name: "Intro to Psychology", start: "11:00", end: "12:15" },
        { name: "Uncanny",             start: "13:15", end: "14:30" },
      ],
      4: [
        { name: "Reasoning bout Unreasonable", start: "11:00", end: "12:15" },
        { name: "Chem Lab",                     start: "13:00", end: "16:00" },
      ],
      5: [ { name: "Chemistry", start: "10:00", end: "10:50" } ],
      0: [], 6: []
    };

    const lockedPhrase = "She's locked asf";
    const BASE_TZ = "America/Los_Angeles";

    const DISPLAY_OPTS = {
      CA: { label: "ðŸŒ´ California", tz: "America/Los_Angeles", offsetMinutesFromCA: 0 },
      CHI:{ label: "ðŸ«˜ Chicago",    tz: "America/Chicago",     offsetMinutesFromCA: 120 },
    };
    let displayKey = localStorage.getItem("displayTZ") || "CA";

    // ---------- Helpers ----------
    function toMinutes(hhmm){ const [h,m]=hhmm.split(":").map(Number); return h*60+m; }
    function pad(n){ return n.toString().padStart(2,"0"); }
    function fmt12(h24,m){ const am=h24<12; const h12=((h24+11)%12)+1; return `${h12}:${pad(m)} ${am?"AM":"PM"}`; }

    function nowInTZ(tz){
      const fmt = new Intl.DateTimeFormat("en-US", {
        timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
      });
      const p = Object.fromEntries(fmt.formatToParts(new Date()).map(x=>[x.type,x.value]));
      return new Date(`${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}:${p.second}`);
    }
    function minutesSinceMidnight(d){ return d.getHours()*60 + d.getMinutes(); }

    function convertFromCA(hhmm){
      const mins = toMinutes(hhmm) + DISPLAY_OPTS[displayKey].offsetMinutesFromCA;
      const norm = ((mins % 1440) + 1440) % 1440;
      const h = Math.floor(norm/60), m = norm % 60;
      return fmt12(h,m);
    }
    function fmtRangeDisplay(startHHMM,endHHMM){ return `${convertFromCA(startHHMM)} â€“ ${convertFromCA(endHHMM)}`; }

    const WEEK = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    function displayDayName(dayIdxCA, minsCA){
      const off = DISPLAY_OPTS[displayKey].offsetMinutesFromCA;
      const total = minsCA + off;
      let shift = 0;
      if (total < 0) shift = -1;
      else if (total >= 1440) shift = 1;
      const idx = (dayIdxCA + shift + 7) % 7;
      return WEEK[idx];
    }

    function currentBlockForCA(dayIndex, minutes){
      const blocks = schedule[dayIndex] || [];
      for (const b of blocks){
        const s = toMinutes(b.start), e = toMinutes(b.end);
        if (minutes >= s && minutes < e) return b;
      }
      return null;
    }

    // ---------- DOM ----------
    const dayLabelEl   = document.getElementById("dayLabel");
    const statusEl     = document.getElementById("status");
    const rangeEl      = document.getElementById("range");
    const clockEl      = document.getElementById("clock");
    const tzToggle     = document.getElementById("tzToggle");
    const tzMenu       = document.getElementById("tzMenu");
    const previewToggle= document.getElementById("previewToggle");
    const previewPanel = document.getElementById("previewPanel");
    const prevDaySel   = document.getElementById("prevDay");
    const prevTimeIn   = document.getElementById("prevTime");
    const applyPreview = document.getElementById("applyPreview");
    const clearPreview = document.getElementById("clearPreview");

    // ---------- Preview state ----------
    // preview = { dayIndex, minutes } or null
    let preview = null;

    // URL param: ?mock=mon-10:00 or ?mock=3-13:15
    (function readMockParam(){
      const q = new URLSearchParams(location.search).get("mock");
      if(!q) return;
      const s = q.toLowerCase().replace(/\s+/g,'');
      const days = {sun:0,mon:1,tue:2,wed:3,thu:4,thur:4,fri:5,sat:6};
      let d = null, t = null;
      const m1 = s.match(/^([a-z]{3,4})[-@](\d{1,2}:\d{2})$/);
      const m2 = s.match(/^([0-6])[-@](\d{1,2}:\d{2})$/);
      if(m1 && days[m1[1]]!==undefined){ d = days[m1[1]]; t = m1[2]; }
      else if(m2){ d = parseInt(m2[1],10); t = m2[2]; }
      if(d!==null && t){
        preview = { dayIndex: d, minutes: toMinutes(t) };
        prevDaySel.value = String(d);
        prevTimeIn.value = t.length===5 ? t : ("0"+t);
      }
    })();

    function updateToggleUI(){
      tzToggle.textContent = DISPLAY_OPTS[displayKey].label;
      tzToggle.setAttribute("aria-expanded", tzMenu.style.display === "block");
      previewToggle.setAttribute("aria-expanded", previewPanel.style.display === "block");
    }
    function openMenu(menu, show){
      menu.style.display = show ? "block" : "none";
      updateToggleUI();
    }

    tzToggle.addEventListener("click", () => openMenu(tzMenu, tzMenu.style.display !== "block"));
    document.addEventListener("click", (e) => {
      if (!tzMenu.contains(e.target) && e.target !== tzToggle) openMenu(tzMenu,false);
      if (!previewPanel.contains(e.target) && e.target !== previewToggle) openMenu(previewPanel,false);
    });

    previewToggle.addEventListener("click", () => {
      if (previewPanel.style.display !== "block" && !preview){
        const nowCA = nowInTZ(BASE_TZ);
        prevDaySel.value = String(nowCA.getDay());
        prevTimeIn.value = `${String(nowCA.getHours()).padStart(2,'0')}:${String(nowCA.getMinutes()).padStart(2,'0')}`;
      }
      openMenu(previewPanel, previewPanel.style.display !== "block");
    });

    applyPreview.addEventListener("click", () => {
      preview = {
        dayIndex: parseInt(prevDaySel.value,10),
        minutes: toMinutes(prevTimeIn.value)
      };
      openMenu(previewPanel,false);
      update();
    });
    clearPreview.addEventListener("click", () => {
      preview = null;
      openMenu(previewPanel,false);
      update();
    });

    // ---------- Main update ----------
    function update(){
      // Determine CA "now" for logic, possibly previewed
      let dayIndexCA, minsCA;
      if (preview){
        dayIndexCA = preview.dayIndex;
        minsCA = preview.minutes;
      } else {
        const nowCA = nowInTZ(BASE_TZ);
        dayIndexCA = nowCA.getDay();
        minsCA = minutesSinceMidnight(nowCA);
      }

      // Day label & clock in display zone (derived from CA + offset)
      const off = DISPLAY_OPTS[displayKey].offsetMinutesFromCA;
      const dispTotal = ((minsCA + off) % 1440 + 1440) % 1440;
      const WEEK = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      // adjust label across midnight boundaries
      let shift = 0;
      if (minsCA + off < 0) shift = -1;
      else if (minsCA + off >= 1440) shift = 1;
      dayLabelEl.textContent = WEEK[(dayIndexCA + shift + 7) % 7];
      clockEl.textContent = fmt12(Math.floor(dispTotal/60), dispTotal % 60);

      // Find current/next blocks (logic in CA)
      const blocks = schedule[dayIndexCA] || [];
      const block  = currentBlockForCA(dayIndexCA, minsCA);

      if (block){
        statusEl.textContent = block.name;
        rangeEl.textContent  = `${fmtRangeDisplay(block.start, block.end)} (${DISPLAY_OPTS[displayKey].label})`;
      } else {
        const next = blocks.find(b => minsCA < toMinutes(b.end));
        if (next){
          statusEl.textContent = lockedPhrase;
          rangeEl.textContent  = `Next Class: ${next.name} â€¢ ${fmtRangeDisplay(next.start, next.end)} (${DISPLAY_OPTS[displayKey].label})`;
        } else {
          if (blocks.length > 0){
            statusEl.textContent = "All Done With Classes! ðŸŽ‰";
            rangeEl.textContent  = "";
          } else {
            statusEl.textContent = lockedPhrase;
            rangeEl.textContent  = "";
          }
        }
      }
    }

    // Timezone menu
    tzMenu.addEventListener("click", (e) => {
      const item = e.target.closest(".tz-item");
      if(!item) return;
      displayKey = item.dataset.tz;
      localStorage.setItem("displayTZ", displayKey);
      openMenu(tzMenu,false);
      update();
    });

    // Kick it off
    updateToggleUI();
    update();
    // Live clock if not previewing
    setInterval(() => { if(!preview) update(); }, 1000);
  </script>
</body>
</html>

